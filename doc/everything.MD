## ä¸€ã€ç³»ç»Ÿæ ¸å¿ƒæµç¨‹å›¾
```mermaid
graph TD
    A[ç”¨æˆ·è¾“å…¥] --> B{å¤šæ¨¡æ€è¾“å…¥}
    B -->|å›¾ç‰‡| C[è§†è§‰ç‰¹å¾æå–]
    B -->|æ–‡æœ¬| D[è¯­ä¹‰ç¼–ç ]
    C --> E[å¤šæ¨¡æ€èåˆ]
    D --> E
    E --> F[FAISSæ··åˆæ£€ç´¢]
    F --> G[çŸ¥è¯†åº“ä¸Šä¸‹æ–‡è·å–]
    G --> H[LLMè¡Œç¨‹ç”Ÿæˆ]
    H --> I[Markdownæ¸²æŸ“]
    I --> J[å›¾æ–‡è¾“å‡º]
```

## äºŒã€æ ¸å¿ƒæµç¨‹è¯¦è§£
### é˜¶æ®µ1ï¼šå¤šæ¨¡æ€è¾“å…¥å¤„ç†

1. è¾“å…¥æ•è·
- Gradioç•Œé¢åŒæ—¶æ¥æ”¶ï¼š

    - å›¾åƒè¾“å…¥ï¼šæ”¯æŒJPG/PNGæ ¼å¼ï¼ˆæœ€å¤§5MBï¼‰
    - æ–‡æœ¬è¾“å…¥ï¼š200å­—ä»¥å†…è‡ªç„¶è¯­è¨€æè¿°
    - ç¤ºä¾‹è¾“å…¥ç»„åˆï¼š
```
inputs = {
    "image": "mountain.jpg", 
    "text": "è®¡åˆ’3å¤©å¾’æ­¥è¡Œç¨‹ï¼Œåå¥½ç”Ÿæ€éœ²è¥"
}
```
2. å¹¶è¡Œç¼–ç 
- è§†è§‰é€šé“ï¼š
```
# ä½¿ç”¨NVIDIA NIMè§†è§‰æœåŠ¡
img_embed = nim.call_service(
    service="multimodal_encoder",
    params={"modality": "image"},
    inputs={"data": image_bytes}
)
```

- æ–‡æœ¬é€šé“ï¼š

```
    # ä½¿ç”¨NVIDIA NIMæ–‡æœ¬æœåŠ¡
text_embed = nim.call_service(
    service="multimodal_encoder", 
    params={"modality": "text"},
    inputs={"data": input_text}
)
```
### é˜¶æ®µ2ï¼šè”åˆæ£€ç´¢
1. ç‰¹å¾èåˆ

- é‡‡ç”¨åŠ æƒæ‹¼æ¥ç­–ç•¥ï¼š
```
fused_embed = np.concatenate([
    0.6 * img_embed,  # è§†è§‰ç‰¹å¾æƒé‡
    0.4 * text_embed  # æ–‡æœ¬ç‰¹å¾æƒé‡
])
```

- L2å½’ä¸€åŒ–å¤„ç†ä¿è¯æ£€ç´¢ç¨³å®šæ€§
2. æ··åˆæ£€ç´¢

- FAISSç´¢å¼•é…ç½®ï¼š
```
index = faiss.IndexHNSWFlat(
    dimension=1024,  # èåˆåç»´åº¦
    M=32,            # HNSWå±‚çº§å‚æ•°
    metric=faiss.METRIC_INNER_PRODUCT
)
```

- æ‰§è¡Œå¤šæ¨¡æ€æ£€ç´¢ï¼š
```
D, I = index.search(fused_embed, k=3)  # è¿”å›top3ç»“æœ
```

###ã€€é˜¶æ®µ3ï¼šè¡Œç¨‹ç”Ÿæˆï¼ˆå…³é”®è·¯å¾„è€—æ—¶<3ç§’ï¼‰
1. ä¸Šä¸‹æ–‡æ„å»º

- åŠ¨æ€æç¤ºå·¥ç¨‹ï¼š
```
prompt_template = """
[ç³»ç»Ÿè§’è‰²] ä¸“ä¸šæ—…è¡Œè§„åˆ’å¸ˆ
[ç”¨æˆ·éœ€æ±‚] {user_text}
[ç›¸å…³æ™¯ç‚¹] {retrieved_pois}
[å›¾ç‰‡ç‰¹å¾] {image_tags}

è¯·ç”ŸæˆåŒ…å«ä»¥ä¸‹è¦ç´ çš„è¡Œç¨‹ï¼š
1. æ¯æ—¥æ—¶é—´è½´ï¼ˆ7:00-22:00ï¼‰ 
2. äº¤é€šè¡”æ¥å»ºè®®
3. å¿…ä½“éªŒé¡¹ç›®ï¼ˆå¸¦emojiæ ‡æ³¨ï¼‰
"""
```
- ç»“æ„åŒ–ç”Ÿæˆ

  - è°ƒç”¨NIMå¯¹è¯æœåŠ¡ï¼š
```
response = nim.call_service(
    service="itinerary_llm",
    inputs={
        "prompt": constructed_prompt,
        "response_format": "markdown"
    },
    params={
        "temperature": 0.3,
        "max_tokens": 1500
    }
)
```

### é˜¶æ®µ4ï¼šç»“æœæ¸²æŸ“
1. å›¾æ–‡åˆæˆ

- Markdownå¢å¼ºæ–¹æ¡ˆï¼š
``` md
## ä¸‰æ—¥å¾’æ­¥è¡Œç¨‹
![éœ²è¥ç‚¹](data:image/jpeg;base64,{thumbnail})  
**Day1**  
âœ… 07:00 å±±è„šé›†åˆ â†’ ğŸšŒ ä¹˜åæ¥é©³è½¦  
ğŸŒ³ 09:00-12:00 é›¨æ—ç©¿è¶Šï¼ˆéœ€æºå¸¦ï¼š...ï¼‰
```

2. è¾“å‡ºä¼˜åŒ–
```
è‡ªåŠ¨ç”Ÿæˆç¼©ç•¥å›¾ï¼š
def generate_thumbnail(img):
    return cv2.resize(img, (320, 240), 
        interpolation=cv2.INTER_AREA)
```


## ä¸‰ã€é¡¹ç›®æ’æœŸ

```mermaid
gantt
    title æ™ºèƒ½è¡Œç¨‹è§„åˆ’ç³»ç»Ÿå¼€å‘æ’æœŸ
    dateFormat  YYYY-MM-DD HH:mm
    axisFormat %d-%H

    section è’‹çº¹
    å¤šæ¨¡æ€è¾“å…¥éªŒè¯       :a1, 2025-02-21 08:30, 14.5h
    æ··åˆæ£€ç´¢ éªŒè¯        :a2, 2025-02-21 08:30, 14.5h
    2 :a3, 2025-02-22 08:30, 14.5h
    3      :c3, 2025-02-23 08:30, 4.5h
    æ–‡æ¡£       :a4, 2025-02-23 13:00, 4h

    section åˆ˜ç¨‹èŒ
    æ•°æ®é›†FAISS é¢„å¤„ç† éªŒè¯ :b1, 2025-02-21  08:30, 14.5h
    æ··åˆæ£€ç´¢ éªŒè¯ :b2 ,2025-02-21  08:30, 14.5h
    2  :b3, 2025-02-22  08:30, 14.5h
    3    :b4, 2025-02-23  08:30, 4.5h
    æ–‡æ¡£       :a4, 2025-02-23 13:00, 4h

    section æ›¾é©³ 
    Jetson demoéªŒè¯    :c1, 2025-02-21, 14.5h
    æ£€ç´¢ç»“æœåˆ°è¾“å‡ºçš„æç¤ºå·¥ç¨‹å¼€å‘     :c2, 2025-02-21, 2d
    3      :c3, 2025-02-23 08:30, 4.5h
    æ–‡æ¡£       :a4, 2025-02-23 13:00, 4h
```